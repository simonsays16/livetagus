<!doctype html>
<html lang="pt-PT">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="LiveTagus - Monitorização em tempo real dos comboios da Fertagus. Veja horários, atrasos e supressões. App gratuita e open-source."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://livetagus.pt/" />
    <meta property="og:title" content="LiveTagus | Fertagus em Tempo Real" />
    <meta
      property="og:description"
      content="LiveTagus - Monitorização em tempo real dos comboios da Fertagus. Veja horários, atrasos e supressões. App gratuita e open-source."
    />
    <meta
      property="og:image"
      content="https://livetagus.pt/imagens/logo_og.webp"
    />

    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://livetagus.pt/" />
    <meta
      property="twitter:title"
      content="LiveTagus | Fertagus em Tempo Real"
    />
    <meta
      property="twitter:description"
      content="LiveTagus - Monitorização em tempo real dos comboios da Fertagus. Veja horários, atrasos e supressões. App gratuita e open-source."
    />
    <meta
      property="twitter:image"
      content="https://livetagus.pt/imagens/logo_og.webp"
    />
    <meta name="theme-color" content="#09090b" />
    <title>LiveTagus | Fertagus em Tempo Real</title>
    <script src="./menu.js" defer></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <link rel="icon" type="image/svg+xml" href="./imagens/favicon-96x96.png" />

    <link rel="alternate icon" href="./imagens/favicon-96x96.png" />

    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="./imagens/apple-touch-icon.png"
    />

    <link rel="manifest" href="/site.webmanifest" />

    <link href="./output.css" rel="stylesheet" />

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400&display=swap"
      rel="stylesheet"
    />

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "LiveTagus",
        "url": "https://livetagus.pt",
        "description": "Monitorização em tempo real dos comboios da Fertagus.",
        "applicationCategory": "TravelApplication",
        "operatingSystem": "Any",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "EUR"
        },
        "author": {
          "@type": "Person",
          "name": "Simão Dias"
        }
      }
    </script>

    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .hero-text {
        line-height: 0.95;
      }
      *:focus-visible {
        outline: 2px solid #3b82f6;
        outline-offset: 2px;
      }

      .spin {
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>

  <body
    class="bg-white text-zinc-900 dark:bg-[#09090b] dark:text-white overflow-x-hidden selection:bg-blue-500/30 transition-colors duration-500"
  >
    <div id="global-nav"></div>

    <main
      class="relative min-h-screen flex flex-col justify-center px-6 pt-24 pb-12"
    >
      <div
        class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[80vw] h-[80vh] bg-blue-600/10 rounded-full blur-[150px] pointer-events-none z-0 hidden dark:block"
      ></div>

      <div class="relative z-10 max-w-4xl mx-auto w-full">
        <div class="mb-12 animate-fade-in-up">
          <h1
            class="hero-text text-5xl md:text-8xl font-light tracking-tighter mb-6 text-transparent bg-clip-text bg-gradient-to-br from-zinc-900 via-zinc-700 to-zinc-500 dark:from-white dark:via-zinc-200 dark:to-zinc-500"
          >
            A FERTAGUS
            <br />
            <span class="font-semibold text-zinc-900 dark:text-white">
              EM TEMPO REAL.
            </span>
          </h1>

          <p
            class="text-lg md:text-xl text-zinc-600 dark:text-zinc-400 font-light max-w-lg leading-relaxed"
          >
            Esquece o desconhecido. A
            <span class="text-zinc-900 dark:text-white font-medium">
              LiveTagus
            </span>
            mostra-te onde anda o comboio, estima atrasos ao segundo e avisa-te
            de supressões.
          </p>
          <!--<div
            class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-blue-500/10 border border-blue-500/20 text-blue-400 text-[10px] font-bold uppercase tracking-widest mt-6"
          >
            <span class="relative flex h-2 w-2">
              <span
                class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"
              ></span>
              <span
                class="relative inline-flex rounded-full h-2 w-2 bg-blue-500"
              ></span>
            </span>
            Versão Testes • Estável a 1 Fev
          </div>-->
          <p class="text-xs text-amber-500/80 font-mono mt-4 items-left">
            <i data-lucide="cone" class="w-3 h-3"></i>
            Versão de testes: funcionalidades completas previstas para
            <b>6 de fevereiro.</b>
            <br />
            (A data foi ajustada para corrigir erros e estabilizar a integração
            de calendário.)
          </p>
        </div>

        <div
          class="flex flex-col gap-3 w-full max-w-xs items-start animate-fade-in-up"
          style="animation-delay: 0.1s"
        >
          <button
            id="main-btn"
            class="hidden w-60 group relative px-8 py-4 bg-zinc-900 dark:bg-white text-white dark:text-black font-bold text-sm uppercase tracking-widest overflow-hidden transition-transform hover:scale-[1.02] shadow-lg text-center"
            aria-label="Ação Principal"
          >
            <span
              id="main-btn-text"
              class="relative z-10 flex items-center justify-center gap-2"
            >
              Instalar WebApp
            </span>
            <div
              class="absolute inset-0 bg-red-600 transform scale-x-0 group-hover:scale-x-100 transition-transform origin-left duration-300"
            ></div>
          </button>

          <div id="installing-msg" class="hidden mt-1 max-w-xs text-left">
            <div
              class="flex items-center gap-2 text-zinc-900 dark:text-white mb-2"
            >
              <svg
                class="w-3 h-3 spin"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 6v6l4 2"></path>
              </svg>
              <span class="text-[10px] font-bold uppercase tracking-widest">
                A preparar instalação...
              </span>
            </div>
            <p
              class="text-[11px] text-zinc-500 dark:text-zinc-400 leading-relaxed"
            >
              A aplicação vai aparecer no menu principal do seu telemóvel.
              <br />
              Por favor, abra-a por lá.
            </p>
          </div>

          <div id="installed-msg" class="hidden mt-1 max-w-xs text-left">
            <p
              class="text-[11px] text-zinc-500 dark:text-zinc-400 leading-relaxed flex items-start gap-1.5"
            >
              <span class="text-green-500 font-bold">✓</span>
              <span>
                Aplicação instalada. Aceda pelo
                <strong>menu principal</strong>
                .
              </span>
            </p>
          </div>

          <a
            id="browser-btn"
            href="./app.html"
            class="w-60 px-8 py-4 border border-zinc-200 dark:border-white/20 text-zinc-900 dark:text-white hover:bg-zinc-100 dark:hover:bg-white/5 font-medium text-sm uppercase tracking-widest transition-all text-center flex items-center justify-center"
            aria-label="Abrir LiveTagus no Navegador"
          >
            Abrir no Browser
          </a>

          <p
            id="web-hint"
            class="text-[10px] text-zinc-400 uppercase tracking-wide w-full text-left ml-1"
          >
            Rápida • Leve • Prática
          </p>
        </div>

        <div
          class="grid grid-cols-2 md:grid-cols-4 gap-8 mt-20 border-t border-zinc-200 dark:border-white/10 pt-10 animate-fade-in-up"
          style="animation-delay: 0.2s"
        >
          <div class="flex flex-col gap-2">
            <h3
              class="text-xs font-bold text-zinc-500 uppercase tracking-widest"
            >
              Precisão
            </h3>
            <p class="text-sm text-zinc-600 dark:text-zinc-300 leading-snug">
              Dados oficiais das infraestruturas em direto.
            </p>
          </div>
          <div class="flex flex-col gap-2">
            <h3
              class="text-xs font-bold text-zinc-500 uppercase tracking-widest"
            >
              Privacidade
            </h3>
            <p class="text-sm text-zinc-600 dark:text-zinc-300 leading-snug">
              Zero tracking. Sem anúncios. 100% Local.
            </p>
          </div>
          <div class="flex flex-col gap-2">
            <h3
              class="text-xs font-bold text-zinc-500 uppercase tracking-widest"
            >
              Velocidade
            </h3>
            <p class="text-sm text-zinc-600 dark:text-zinc-300 leading-snug">
              Interface leve otimizada para rede móvel.
            </p>
          </div>
          <div class="flex flex-col gap-2">
            <h3
              class="text-xs font-bold text-zinc-500 uppercase tracking-widest"
            >
              Gratuito
            </h3>
            <p class="text-sm text-zinc-600 dark:text-zinc-300 leading-snug">
              Serviço totalmente gratuito e sem anúncios.
            </p>
          </div>
        </div>
      </div>
    </main>

    <!--<footer class="hidden">
      <p>
        Horários Fertagus em tempo real para as estações: Roma-Areeiro,
        Entrecampos, Sete Rios, Campolide, Pragal, Corroios, Foros de Amora,
        Fogueteiro, Coina, Penalva, Pinhal Novo, Venda do Alcaide, Palmela e
        Setúbal. Projeto independente e não oficial. Sem afiliação à Fertagus ou
        IP. Todos os direitos sobre os dados de circulação pertencem aos
        respetivos proprietários.
        <br />
        Atrasos Fertagus, Próximo comboio fertagus, problemas fertagus, fertagus
        hoje, fertagus atrasos comboio hoje, fertagus horário, fertagus horario
        <br />
        Em caso de dúvida, erro ou sugestão contacte-nos:
      </p>
      <a aria-label="Email de Contacto" href="mailto:geral@livetagus.pt">
        geral@livetagus.pt
      </a>
      <p>Desenvolvido por Simão Dias.</p>
      <p>Consulte atrasos e supressões na linha da Ponte 25 de Abril.</p>
    </footer>-->
    <div id="global-footer"></div>

    <script>
      // === GESTOR PWA v8.0 (Lógica Estrita: 30s Wait) ===

      let deferredPrompt;
      const mainBtn = document.getElementById("main-btn");
      const mainBtnText = document.getElementById("main-btn-text");
      const installingMsg = document.getElementById("installing-msg");
      const installedMsg = document.getElementById("installed-msg");
      const browserBtn = document.getElementById("browser-btn");
      const webHint = document.getElementById("web-hint");

      // 1. Deteção Inicial (Simples)
      const isStandalone =
        window.matchMedia("(display-mode: standalone)").matches ||
        window.navigator.standalone ||
        document.referrer.includes("android-app://");

      if (isStandalone) {
        // DENTRO DA APP: Botão "Ver Tempo Real"
        setupUIForApp();
      } else if (localStorage.getItem("pwa_installed") === "true") {
        // NO BROWSER (Instalada): Nota simples
        setupUIForInstalled();
      }

      // 2. Evento de Prompt de Instalação
      window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        deferredPrompt = e;

        // Se o browser diz que pode instalar, mostramos o botão
        // (Ignorando se já tínhamos guardado antes, pois o user pode ter desinstalado)
        if (!isStandalone) {
          localStorage.removeItem("pwa_installed");
          setupUIForInstall();
        }
      });

      // --- SETUP DE UI ---

      function setupUIForApp() {
        mainBtn.classList.remove("hidden");
        mainBtnText.innerHTML =
          'Ver Tempo Real&nbsp&nbsp<span id="status-dot-footer" class="w-2 h-2 rounded-full bg-zinc-300 dark:bg-zinc-700"></span>';
        mainBtn.onclick = () => (window.location.href = "./app.html");

        browserBtn.style.display = "none";
        webHint.innerText = "Verifica se há atrasos";
        installedMsg.classList.add("hidden");
        installingMsg.classList.add("hidden");
      }

      function setupUIForInstall() {
        mainBtn.classList.remove("hidden");
        mainBtnText.textContent = "Instalar WebApp";
        mainBtn.onclick = handleInstallClick;

        installedMsg.classList.add("hidden");
        installingMsg.classList.add("hidden");
        browserBtn.style.display = "flex";
        webHint.style.display = "block";
      }

      function setupUIForInstalled() {
        mainBtn.classList.add("hidden"); // Esconde botão instalar
        installingMsg.classList.add("hidden");
        installedMsg.classList.remove("hidden"); // Mostra a nota

        browserBtn.style.display = "flex";
        webHint.style.display = "block";
      }

      // --- LOGICA DE CLIQUE (ESTRITA 30s) ---

      async function handleInstallClick() {
        if (!deferredPrompt) {
          alert(
            "Para instalar: \niOS: Partilhar -> Ecrã Principal\nAndroid: Menu -> Instalar App",
          );
          return;
        }

        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;

        if (outcome === "accepted") {
          // 1. Esconde botão
          mainBtn.classList.add("hidden");

          // 2. Mostra nota de "A preparar..."
          installingMsg.classList.remove("hidden");

          // 3. AGUARDA ESTRITAMENTE 30 SEGUNDOS
          setTimeout(() => {
            finishInstallation();
          }, 30000);
        }

        deferredPrompt = null;
      }

      function finishInstallation() {
        // 4. Conclui: guarda memória e mostra nota final
        localStorage.setItem("pwa_installed", "true");

        installingMsg.classList.add("hidden");
        installedMsg.classList.remove("hidden");
      }
    </script>
  </body>
</html>
